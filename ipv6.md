# IPv6 база
В данном гайде я постараюсь описать самую базовую информацию для понимания новой версии сетевого протокола.
На основе [видео Андрея Созыкина](https://youtu.be/KRAKAAJTxTg?si=LYOrMsXfDsoCqg-s).
## Основные понятия новой версии
 - Использует **16-ричную систему исчисления**
 - Новая версия протокола имеет разрядность **128 бит**
 - Имеет **8 гекстетов** (группа 4-х чисел, разделенных двоеточиями) по **16 бит** (1 символ = 4 бит)

## Префикс IPv6
Как и в IPv4, в новой версии протокола есть адреса подсети, адреса хоста и маска подсети, но имеют другие названия:

 - **Адрес подсети** называется **Префикс IPv6** 
 - **Адрес хоста** называется **Адрес интерфейса**
 - **Маска подсети** называется **Длина префикса**
 
![image](https://i.imgur.com/dcY1r47.png)

## Вычисление префикса IPv6
Длина префикса кратна 16:
 - Адрес: 2a02:06b8:0892:ad61:59a2:3149:c5a0:67a4/64
 - Префикс: 2a02:06b8:0892:ad61:0000:0000:0000:0000 
> Если длина префикса кратна 16, то префикс заканчивается на одном из октетов.

Длина префикса кратна 4:
 - Адрес: 2a02:06b8:0892:ad61:59a2:3149:c5a0:67a4/52
 - Префикс: **2a02:06b8:0892:a**000:0000:0000:0000:0000

> Разделим Длину Префикса на 4:
> 52 : 4 = 13
> 13 символом нужно отступить слева - это и будет адрес сети
> Остальная часть заменяется нулями.

Длина префикса не кратна 4:
 - Адрес: 2a02:06b8:0892:ad61:59a2:3149:c5a0:67a4/54
 - Префикс: **2a02:06b8:0892:ac**00:0000:0000:0000:0000
 
> 1. Чтобы найти префикс, необходимо перевести октет, на котором останавливается префикс (4-й октет) и перевести его в двоичную систему:
> **ad61** (16-ричная) -> **1010110101100001** (2-чная)
> 
> 2. Длина префикса высчитывается для конкретного октета, то есть, если у нас длина префикса равна **54**, то это будет **3 целых октета**:
> 54 : 16 = 3,375 (48 бит = 3 октета и 6 бит в остатке) 
> **Эти 6 бит и будут в 4-м октете**
>
>3. Необходимо выполнить логическое **И (AND)** между адресом и оставшейся длиной префикса в октете, на котором останавливается префикс (то есть 6 бит). 
> **1010110101100001** - октет
> **1111110000000000** - оставшиеся биты
> ***1010110000000000*** - результат
>4. Переводим результат из двоичной системы в 16-ричную:
> ***1010110000000000*** (2-чная) -> **ac00** (16-ричная)

## Структура адреса IPv6

![Структура IPv6 адреса](https://i.imgur.com/zMrtsnM.png)

> Для адреса хоста обычно используется MAC-адрес сетевого интерфейса устройства.

## Правила сокращения IPv6 адресов
**Полный адрес IPv6: 
2a02:06b8:0000:0001:0000:0000:feed:0a11** 

 1. Удаление ведущих нулей:
	 2a02:6b8:0:1:0:0:feed:a11
> Удаляем нули **В НАЧАЛЕ.**
2. Пропуск 2-х и более идущих подряд групп нулей:
	2a02:6b8:0:1::feed:a11
> Заменяем группы `0000:0000` на `::`

## Неправильные сокращения
**Полный адрес IPv6: 
2a02:06b8:0000:1000:0ca0:0000:feed:0a11** 
 1. Неправильное удаление ведущих нулей:
	 2a02:6b8:0:**1:ca**:0:feed:a11

> - Можно удалять только нули, **стоящие в начале октета**, иначе нельзя будет точно сказать, какой был октет до сокращения.
> - Правильно: 2a02:6b8:0:1000:ca0:0:feed:a11
2. Пропуск двух групп нулей:
	**FE80:0000:0000:abdc:0000:0000:0000:ab11**
	**Неправильно:** FE80::abdc::ab11
	**Правильно:** FE80:0:0:abdc::ab11
> 
>- Можно сократить лишь одну группу, иначе в сокращенном варианте будет неясно, сколько октетов было сокращено.
>- Сокращаем наибольшую группы подряд идущих нулей.

	
## Типы адресов IPv6

 - Индивидуальный (одноадресная рассылка, unicast)
 

> 1. Представляют отдельные устройства в сети
> 2. Могут быть глобальными или локальными
> 3. Используются для двусторонней связи между двумя устройствами

 - Групповой (многоадресная рассылка, multicast) - используется для отправки одного пакета на несколько адресов.
 

> 1. Представляют группы устройств
> 2. Начинаются с ff00::/8
> 3. Используются для рассылки трафика всем устройствам в группе
> 4. Адрес ff02::1 используется для многоадресной рассылки в локальной сети

 - Произвольный (anycast) - любой индивидуальный адрес, может быть назначен нескольким устройствам. Пакет направленный

> 1. Не представляет никаких устройств или групп
> 2. Могут быть использованы для различных целей, таких как маршрутизация или фильтрация трафика
> 3. Не имеют определенного формата и могут принимать любое значение в пределах диапазона IPv6 адресов
>
>Примеры:
> - ::/0 - адрес по умолчанию, который соответствует всем адресам IPv6.
>- ::1/128 - адрес обратной связи, который соответствует локальному устройству.
>- fe80::/10 - префикс для единоличных адресов.
>- ff00::/8 - префикс для групповых адресов.
>- 2001:db8::/32 - произвольный префикс, который можно использовать для назначения адресов устройствам в сети.

**В IPv6 нет широковещательных адресов (broadcast). Вместо них используются Групповые адреса (multicast) специального вида.**

## Начальные октеты адресов IPv6
| Тип адреса | Начальный октет | 
|--|--|
| Глобальный | 2 или 3 |
| Локальный | FD |
|Локальный канал связи| FE80|
| Групповой | FF |

## Специальные IPv6 адреса

 - ::/128 - текущий хост 
 - ::/0 - маршрут по умолчанию
 - ::1/128 - обратная петля (loopback)
 - ff02::1 - все узлы в канале связи
 - ff02::2 - все маршрутизаторы в канале связи

# Практика

Топология
![Топология сети в Cisco PT](https://i.imgur.com/KvFxAP2.png)
-

По умолчанию выдаются IPv6 link-local адреса на основе MAC-адреса устройства.

Сетевые настройки:

![ipconfig](https://i.imgur.com/vtqPmPv.png)

-----

Уже на этом этапе, когда хосты соединены между собой только Свичом, можно пропинговать их между собой. 

Пинг с PC1 на PC2:

![ping](https://i.imgur.com/MGFawCU.png)

-----

Настроим роутер. Включаем маршрутизацию пакетов ipv6 командой в режиме конфигурации терминала:

    Router(config)#ipv6 unicast-routing
    
Прописываем link-local адрес на интерфейсы Gig0/0 и Gig0/1 и включаем интерфейсы:

    Router(config)#int gig0/0
    Router(config-if-range)#ipv6 address FE80::1 link-local
    Router(config-if-range)#no shut
    Router(config)#int gig0/1
    Router(config-if-range)#ipv6 address FE80::1 link-local
    Router(config-if-range)#no shut

> В IPv6 можно указывать как несколько IP-адресов на один интерфейс, так и одинаковые link-local адреса на разные интерфейсы одного устройства.

Пинг до роутера из сегментов не будет проходить, пока не укажем IPv6 Gateway.

![Шлюз по умолчанию](https://i.imgur.com/6yYhOcU.png)

-----

Пинг между PC3 и PC1 или PC2 не пройдет, так как link-local работает только внутри своего сегмента и не маршрутизируется, то есть роутер не сможет отправить пакеты по link-local адресу из одного сегмента в другой.

2 Сегмента сети обозначены красным контуром:

![Сегменты сети](https://i.imgur.com/Q9gnGYV.png)

Необходимо прописать GUA (Global Unicast Address) на интерфейсы роутера. Левый сегмент будет Подсетью A, правый - Подсетью B.

    Router(config-if)#int gig0/0
    Router(config-if)#ipv6 address 2001:DB8:AAAA:A::1/64
    Router(config-if)#int gig0/1
    Router(config-if)#ipv6 address 2001:DB8:AAAA:B::1/64

Настроенный роутер начинает рассылать свои анонсы со всеми необходимыми для настройки сети параметрами, в т.ч. префикс сети, на основе которого, хост получает свой уникальный IPv6 адрес, используя link-local адрес, который в свою очередь использует MAC-адрес.

Автоматическая выдача сетевых настроек по протоколу SLAAC:

![enter image description here](https://i.imgur.com/YvBwHIr.png)

Успешный пинг из разных сегментов:

![enter image description here](https://i.imgur.com/A9E26sh.png)



